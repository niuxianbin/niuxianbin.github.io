<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="å­œå­œä¸å€¦">
<meta property="og:type" content="website">
<meta property="og:title" content="niuxianbinçš„æŠ€æœ¯åšå®¢">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="niuxianbinçš„æŠ€æœ¯åšå®¢">
<meta property="og:description" content="å­œå­œä¸å€¦">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="niuxianbinçš„æŠ€æœ¯åšå®¢">
<meta name="twitter:description" content="å­œå­œä¸å€¦">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>niuxianbinçš„æŠ€æœ¯åšå®¢</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">niuxianbinçš„æŠ€æœ¯åšå®¢</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">å­¦æµ·æ— æ¶¯</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/11/iOSæ”»é˜²-æ³¨å…¥/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="niuxianbin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/upload/15234019.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="niuxianbinçš„æŠ€æœ¯åšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/11/iOSæ”»é˜²-æ³¨å…¥/" itemprop="url">iOSæ”»é˜²-æ³¨å…¥</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-08-11T23:53:23+08:00">
                2017-08-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/21/iOSå¼€å‘ä¸­çš„é”/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="niuxianbin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/upload/15234019.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="niuxianbinçš„æŠ€æœ¯åšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/21/iOSå¼€å‘ä¸­çš„é”/" itemprop="url">iOSå¼€å‘ä¸­çš„é”</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-07-21T14:53:23+08:00">
                2017-07-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/15/é¢„é˜²crashä¹‹unrecognized selector/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="niuxianbin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/upload/15234019.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="niuxianbinçš„æŠ€æœ¯åšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/15/é¢„é˜²crashä¹‹unrecognized selector/" itemprop="url">é¢„é˜²crashä¹‹unrecognized selector</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-05-15T20:33:43+08:00">
                2017-05-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="unrecognized-selectoråŸå› åˆ†æ"><a href="#unrecognized-selectoråŸå› åˆ†æ" class="headerlink" title="unrecognized selectoråŸå› åˆ†æ"></a>unrecognized selectoråŸå› åˆ†æ</h2><p>Appçš„å´©æºƒåŸå› æœ‰å¾ˆå¤šç§ï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦é˜è¿°é˜²æ­¢å‘é€æœªçŸ¥æ¶ˆæ¯(unrecognized selector)å¼•èµ·crashçš„é—®é¢˜ã€‚ç®€å•æ¥è¯´unrecognized selectorç±»å‹çš„crashæ˜¯å› ä¸ºä¸€ä¸ªå¯¹è±¡è°ƒç”¨äº†ä¸€ä¸ªä¸å±äºå®ƒçš„æ–¹æ³•å¯¼è‡´çš„,</p>
<h2 id="è§£å†³æ–¹æ¡ˆåˆ†æ"><a href="#è§£å†³æ–¹æ¡ˆåˆ†æ" class="headerlink" title="è§£å†³æ–¹æ¡ˆåˆ†æ"></a>è§£å†³æ–¹æ¡ˆåˆ†æ</h2><p><img src="/img/0321.jpeg" alt=""><br>ä¸Šå›¾æ˜¯OCç»å…¸çš„æ¶ˆæ¯è½¬å‘æœºåˆ¶ï¼Œåœ¨OCçš„æ–¹æ³•è°ƒç”¨ä¸­ï¼Œé€šè¿‡superclassæŒ‡é’ˆé€çº§å‘ä¸ŠæŸ¥æ‰¾è¯¥æ¶ˆæ¯æ‰€å¯¹åº”çš„æ–¹æ³•å®ç°ã€‚å¦‚æœç›´åˆ°æ ¹ç±»éƒ½æ²¡æœ‰æ‰¾åˆ°è¿™ä¸ªæ–¹æ³•çš„å®ç°ï¼Œå°±ä¼šå‡ºå‘æ¶ˆæ¯è½¬å‘ï¼Œå¦‚ä¸Šå›¾ï¼Œæ‰€ä»¥å¯ä»¥ä»ä»¥ä¸Šä¸‰ä¸ªæ–¹æ³•ä¸­å®ç°åŠ¨æ€å¤„ç†unrecognized selectorçš„å¼‚å¸¸</p>
<h2 id="æ–¹æ¡ˆ1-é‡å†™NSObjectçš„forwardingTargetForSelector"><a href="#æ–¹æ¡ˆ1-é‡å†™NSObjectçš„forwardingTargetForSelector" class="headerlink" title="æ–¹æ¡ˆ1:é‡å†™NSObjectçš„forwardingTargetForSelector"></a>æ–¹æ¡ˆ1:é‡å†™NSObjectçš„forwardingTargetForSelector</h2><p>ğŸğŸ æ€è·¯ï¼š</p>
<ul>
<li>NSObjectæ·»åŠ åˆ†ç±»ï¼Œé‡å†™forwardingTargetForSelector</li>
<li>åŠ¨æ€åˆ›å»ºProtectorç±»ï¼Œåœ¨forwardingTargetForSelectoræ–¹æ³•ä¸­æˆªè·æœªå®ç°çš„æ–¹æ³•ï¼Œè½¬å‘ç»™Protectorã€‚å¹¶ä¸ºProtector åŠ¨æ€çš„æ·»åŠ æœªå®ç°çš„æ–¹æ³•</li>
<li>åŠ¨æ€ç»™Protectorç±»æ·»åŠ æ–¹æ³•å®ç°ï¼Œ</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"NSObject+Protector.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;objc/message.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></span><br><span class="line"><span class="meta">#pragma clang diagnostic push</span></span><br><span class="line"><span class="meta">#pragma clang diagnostic ignored <span class="meta-string">"-Wobjc-protocol-method-implementation"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSObject</span> (<span class="title">Protector</span>)</span></span><br><span class="line"></span><br><span class="line">-(<span class="keyword">id</span>)forwardingTargetForSelector:(SEL)aSelector&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> ([[<span class="keyword">self</span> <span class="keyword">class</span>] isSubclassInWhiteListClass])</span><br><span class="line">    &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">NSString</span> *className = <span class="string">@"ProtectorDynamicClass"</span>;</span><br><span class="line">        Class protocalClass = objc_lookUpClass(className.UTF8String);</span><br><span class="line">        <span class="keyword">if</span> (!protocalClass)</span><br><span class="line">        &#123;</span><br><span class="line">            protocalClass =  objc_allocateClassPair([<span class="built_in">NSObject</span> <span class="keyword">class</span>], className.UTF8String, <span class="number">0</span>);</span><br><span class="line">            objc_registerClassPair(protocalClass);</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æ­¤å¤„å¯ä¸ç”¨åˆ¤æ–­</span></span><br><span class="line">        <span class="keyword">if</span> (![protocalClass isEXit:aSelector]) &#123;</span><br><span class="line">             class_addMethod(protocalClass, aSelector, [protocalClass getIMP], <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">        [<span class="keyword">self</span> warningDeveloper:aSelector];</span><br><span class="line">        <span class="keyword">return</span> [[protocalClass alloc]init];</span><br><span class="line">        </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma clang diagnostic pop</span></span><br><span class="line"></span><br><span class="line">+(IMP)getIMP&#123;</span><br><span class="line">    <span class="keyword">return</span> imp_implementationWithBlock(^()&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"PROTECTOR: add IMP Done"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">+(<span class="built_in">BOOL</span>)isEXit:(SEL)sel &#123;</span><br><span class="line">    <span class="built_in">BOOL</span> isExit = <span class="literal">NO</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> methodCount = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">NSString</span> *selName = <span class="built_in">NSStringFromSelector</span>(sel);</span><br><span class="line">    Method *methodList = class_copyMethodList([<span class="keyword">self</span> <span class="keyword">class</span>], &amp;methodCount);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; methodCount; i++) &#123;</span><br><span class="line">        Method currentMethod = methodList[i];</span><br><span class="line">        SEL currentSEL  =  method_getName(currentMethod);</span><br><span class="line">        <span class="keyword">if</span> ([selName isEqualToString:<span class="built_in">NSStringFromSelector</span>(currentSEL)]) &#123;</span><br><span class="line">            isExit = <span class="literal">YES</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//éœ€è¦æ‰‹åŠ¨é‡Šæ”¾</span></span><br><span class="line">    free(methodList);</span><br><span class="line">    <span class="keyword">return</span> isExit;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">BOOL</span>)isSubclassInWhiteListClass&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSArray</span> *classNameArray = @[<span class="string">@"NSNull"</span>,<span class="string">@"UIResponder"</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSString</span> *className <span class="keyword">in</span> classNameArray) &#123;</span><br><span class="line">        <span class="keyword">if</span> ([<span class="keyword">self</span> isSubclassOfClass:<span class="built_in">NSClassFromString</span>(className)]) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)warningDeveloper:(SEL)aSelector&#123;</span><br><span class="line"><span class="meta">#if DEBUG</span></span><br><span class="line">    <span class="built_in">NSString</span> *selectorStr = <span class="built_in">NSStringFromSelector</span>(aSelector);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"PROTECTOR: -[%@ %@]"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], selectorStr);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"PROTECTOR: unrecognized selector \"%@\" sent to instance: %p"</span>, selectorStr, <span class="keyword">self</span>);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"PROTECTOR: call stack: %@"</span>, [<span class="built_in">NSThread</span> callStackSymbols]);</span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ–¹æ¡ˆ2-é‡å†™NSObjectçš„methodSignatureForSelector"><a href="#æ–¹æ¡ˆ2-é‡å†™NSObjectçš„methodSignatureForSelector" class="headerlink" title="æ–¹æ¡ˆ2:é‡å†™NSObjectçš„methodSignatureForSelector"></a>æ–¹æ¡ˆ2:é‡å†™NSObjectçš„methodSignatureForSelector</h2><p>ğŸğŸ æ€è·¯ï¼š</p>
<ul>
<li>NSObjectæ·»åŠ åˆ†ç±»ï¼Œé‡å†™methodSignatureForSelector</li>
<li>æ£€æŸ¥æ˜¯å¦åœ¨ç™½åå•å†…ï¼Œåœ¨çš„è¯è¿”å›ä¸€ä¸ªç©ºç­¾åï¼Œä»€ä¹ˆä¹Ÿä¸åš</li>
<li>ä¸å†èŒƒå›´å†…ï¼Œè¿”å›åŸæ¥çš„ç­¾åï¼Œèµ°åŸæ¥çš„é€»è¾‘<br>ç¼ºç‚¹ï¼š<br>æ­¤æ–¹æ¡ˆä¼šå’Œåˆ«çš„ä½¿ç”¨AOPçš„ç¬¬ä¸‰æ–¹åº“å†²çªï¼ˆä¾‹å¦‚Aspectsï¼‰ï¼Œå‡ºç°å¥‡è‘©é—®é¢˜ï¼Œå­˜åœ¨ä¼˜åŒ–ç©ºé—´ï¼Œç¬¬ä¸‰ç§æ–¹æ¡ˆçš„æ¥æºã€‚æ­¤å¤„ä»£ç çœç•¥ï¼Œå‚è€ƒæ–¹æ¡ˆ3çš„ä»£ç ã€‚</li>
</ul>
<h2 id="æ–¹æ¡ˆ3-é‡å†™å°‘é‡ç±»çš„methodSignatureForSelector"><a href="#æ–¹æ¡ˆ3-é‡å†™å°‘é‡ç±»çš„methodSignatureForSelector" class="headerlink" title="æ–¹æ¡ˆ3:é‡å†™å°‘é‡ç±»çš„methodSignatureForSelector"></a>æ–¹æ¡ˆ3:é‡å†™å°‘é‡ç±»çš„methodSignatureForSelector</h2><p>ç¬¬ä¸‰æ–¹åº“å¯¹ methodSignatureForSelectorè¿›è¡Œäº†å…¨å±€æ›¿æ¢ï¼Œè€Œæˆ‘ä»¬ä¹Ÿåœ¨NSObjectä¸­ è¿›è¡Œäº†å…¨å±€æ›¿æ¢ï¼Œè¿™å°±æœ‰äº†å†²çªã€‚ç”¨å®å®šä¹‰çš„æ–¹å¼å¯¹å‡ ä¸ªç±»å¤„ç†å³å¯ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"NSString+Protector.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define ELOANCN_PROTECTOR(_ClassName_)\</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">_ClassName_</span> (<span class="title">ELProtector</span>)\</span></span><br><span class="line">-(<span class="built_in">NSMethodSignature</span> *)methodSignatureForSelector:(SEL)aSelector&#123;\</span><br><span class="line">\</span><br><span class="line"><span class="built_in">NSMethodSignature</span> *signature = [<span class="keyword">super</span> methodSignatureForSelector:aSelector];\</span><br><span class="line"><span class="keyword">if</span> (!signature)\</span><br><span class="line">&#123;\</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">NSMutableDictionary</span> *signatureCache = <span class="literal">nil</span>;\</span><br><span class="line">    \</span><br><span class="line">    <span class="keyword">if</span> (signatureCache == <span class="literal">nil</span>)\</span><br><span class="line">    &#123;\</span><br><span class="line">        signatureCache = [<span class="built_in">NSMutableDictionary</span> new];\</span><br><span class="line">        \</span><br><span class="line">    &#125;\</span><br><span class="line">    \</span><br><span class="line">    signature = [signatureCache objectForKey:<span class="built_in">NSStringFromSelector</span>(aSelector)];\</span><br><span class="line">    \</span><br><span class="line">    <span class="keyword">if</span> (!signature)\</span><br><span class="line">    &#123;\</span><br><span class="line">        signature = [<span class="built_in">NSMethodSignature</span> signatureWithObjCTypes:<span class="string">"@"</span>];\</span><br><span class="line">        signatureCache[<span class="built_in">NSStringFromSelector</span>(aSelector)] =signature;\</span><br><span class="line">    &#125;\</span><br><span class="line">    \</span><br><span class="line">    \</span><br><span class="line">&#125;\</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"PROTECTOR: unrecognized selector \"%@\" sent to instance: %p"</span>, <span class="built_in">NSStringFromSelector</span>(aSelector), <span class="keyword">self</span>);\</span><br><span class="line"><span class="keyword">if</span> (TARGET_OS_SIMULATOR)\</span><br><span class="line">&#123;\</span><br><span class="line">    <span class="built_in">NSException</span> *excp = [<span class="built_in">NSException</span> exceptionWithName:<span class="string">@"unrecognized selector"</span> reason:<span class="string">@" unrecognized selector sent to instance"</span> userInfo:<span class="literal">nil</span>];\</span><br><span class="line">    [excp raise];\</span><br><span class="line">&#125;\</span><br><span class="line"><span class="keyword">return</span> signature;\</span><br><span class="line">\</span><br><span class="line">&#125;\</span><br><span class="line"><span class="keyword">@end</span>\</span><br><span class="line"></span><br><span class="line">ELOANCN_PROTECTOR(<span class="built_in">NSString</span>);</span><br><span class="line">ELOANCN_PROTECTOR(<span class="built_in">NSNull</span>);</span><br></pre></td></tr></table></figure></p>
<h2 id="é›†æˆè¿›é¡¹ç›®çš„é—®é¢˜"><a href="#é›†æˆè¿›é¡¹ç›®çš„é—®é¢˜" class="headerlink" title="é›†æˆè¿›é¡¹ç›®çš„é—®é¢˜"></a>é›†æˆè¿›é¡¹ç›®çš„é—®é¢˜</h2><ol>
<li>ä¸åŠ ç™½åå•ï¼Œç›´æ¥ç»™NSObjectåˆ†ç±»é‡å†™æ¶ˆæ¯è½¬å‘çš„æ–¹æ³•ï¼Œåœ¨é¡¹ç›®å¯åŠ¨åŠ è½½æ—¶ä¼šæœ‰è«åçš„å¼‚å¸¸æŠ›å‡ºã€‚</li>
<li>é‡å†™çš„å¯¹åº”çš„æ–¹æ³•methodSignatureForSelectorï¼Œé¡¹ç›®çš„ç¬¬ä¸‰æ–¹åº“ä¸­ä¹Ÿå¯èƒ½é‡å†™äº†ï¼Œéœ€è¦è‡ªå·±æ£€æŸ¥å¤„ç†ã€‚</li>
</ol>
<p>æ€è·¯æ¥æºï¼š<a href="https://www.jianshu.com/p/521dd19d4406" target="_blank" rel="noopener">Mad_Mark</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/10/é¢„é˜²crashä¹‹åˆ·æ–°UIçº¿ç¨‹æ£€æŸ¥/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="niuxianbin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/upload/15234019.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="niuxianbinçš„æŠ€æœ¯åšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/10/é¢„é˜²crashä¹‹åˆ·æ–°UIçº¿ç¨‹æ£€æŸ¥/" itemprop="url">é¢„é˜²crashä¹‹åˆ·æ–°UIçº¿ç¨‹æ£€æŸ¥</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-04-10T11:33:43+08:00">
                2017-04-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="ä¸ºä»€ä¹ˆä¸»çº¿ç¨‹åˆå«UIçº¿ç¨‹"><a href="#ä¸ºä»€ä¹ˆä¸»çº¿ç¨‹åˆå«UIçº¿ç¨‹" class="headerlink" title="ä¸ºä»€ä¹ˆä¸»çº¿ç¨‹åˆå«UIçº¿ç¨‹"></a>ä¸ºä»€ä¹ˆä¸»çº¿ç¨‹åˆå«UIçº¿ç¨‹</h2><p> ä¸ºä»€ä¹ˆéƒ½è¦åœ¨ä¸»çº¿ç¨‹ä¸­æ›´æ–°UIï¼Ÿ,å¤§å®¶éƒ½çŸ¥é“UIKitæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯åƒUIKitè¿™æ ·å¤§çš„æ¡†æ¶ä¸Šç¡®ä¿çº¿ç¨‹å®‰å…¨æ˜¯ä¸€ä¸ªé‡å¤§çš„ä»»åŠ¡ï¼Œä¼šå¸¦æ¥å·¨å¤§çš„æˆæœ¬ã€‚å‡å¦‚åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¸­è®¾ç½®äº†åŒä¸€å¼ èƒŒæ™¯å›¾ç‰‡ï¼Œå¾ˆæœ‰å¯èƒ½å°±ä¼šç”±äºèƒŒæ™¯å›¾ç‰‡è¢«é‡Šæ”¾ä¸¤æ¬¡ï¼Œä½¿å¾—ç¨‹åºå´©æºƒã€‚æˆ–è€…æŸä¸€ä¸ªçº¿ç¨‹ä¸­éå†æ‰¾å¯»æŸä¸ªsubViewï¼Œç„¶è€Œåœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­åˆ é™¤äº†è¯¥subViewï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆé”™ä¹±ã€‚appleæœ‰å¯¹å¤§éƒ¨åˆ†çš„ç»˜å›¾æ–¹æ³•å’Œè¯¸å¦‚UIColorç­‰ç±»æ”¹å†™æˆçº¿ç¨‹å®‰å…¨å¯ç”¨ï¼Œå¯è¿˜æ˜¯å»ºè®®å°†UIæ“ä½œä¿è¯åœ¨ä¸»çº¿ç¨‹ã€‚</p>
<h2 id="åå°çº¿ç¨‹æ›´æ–°UIä¼šæ€æ ·"><a href="#åå°çº¿ç¨‹æ›´æ–°UIä¼šæ€æ ·" class="headerlink" title="åå°çº¿ç¨‹æ›´æ–°UIä¼šæ€æ ·"></a>åå°çº¿ç¨‹æ›´æ–°UIä¼šæ€æ ·</h2><p> åœ¨åå°çº¿ç¨‹æ›´æ–°UIï¼Œå¤§æ¦‚ç‡ä¼šcrash,æœ‰å¯èƒ½æ˜¾ç¤ºçš„æ•ˆæœä¸ç¬¦åˆé¢„æœŸã€‚æ¯”å¦‚å¯èƒ½ä¼šå‡ºç°ä¸¢å¤±åŠ¨ç”»ï¼Œé¡µé¢é”™ä¹±ç­‰é—®é¢˜ã€‚</p>
<h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>åŸç†ï¼šUIViewã€CALayerçš„setNeedsLayoutã€setNeedsDisplayã€setNeedsDisplayInRect:ä¸‰ä¸ªæ–¹æ³•ï¼Œæ˜¯åˆ·æ–°UIçš„ä¸‰ä¸ªå…³é”®æ–¹æ³•ã€‚å½“è°ƒç”¨è¿™ä¸‰ä¸ªæ–¹æ³•æ—¶åˆ¤æ–­æ˜¯å¦åœ¨ä¸»çº¿ç¨‹ï¼Œå¦‚æœä¸åœ¨ä¸»çº¿ç¨‹è°ƒç”¨å°±è®©ç¨‹åºcrashï¼Œåœ¨crashå †æ ˆèƒ½çœ‹å‡ºæ˜¯å“ªé‡Œçš„é—®é¢˜ï¼Œå› æ­¤æˆ‘ä»¬hookä¸‰ä¸ªæ–¹æ³•ï¼Œå»ºè®®åªåœ¨å¼€å‘é˜¶æ®µä½¿ç”¨<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#define dispatch_main_async_safe(block)\</span></span><br><span class="line"><span class="keyword">if</span> ([<span class="built_in">NSThread</span> isMainThread]) &#123;\</span><br><span class="line">block();\</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;\</span><br><span class="line"><span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), block);\</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">UIView</span> (<span class="title">ThreadCheck</span>)</span></span><br><span class="line"><span class="meta">#if DEBUG</span></span><br><span class="line">+(<span class="keyword">void</span>)load&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</span><br><span class="line">         [<span class="keyword">self</span> swizzleSelector:<span class="keyword">@selector</span>(setNeedsLayout) withSwizzledSelector:<span class="keyword">@selector</span>(EL_setNeedsLayout)];</span><br><span class="line">         [<span class="keyword">self</span> swizzleSelector:<span class="keyword">@selector</span>(setNeedsDisplay) withSwizzledSelector:<span class="keyword">@selector</span>(EL_setNeedsDisplay)];</span><br><span class="line">         [<span class="keyword">self</span> swizzleSelector:<span class="keyword">@selector</span>(setNeedsDisplayInRect:) withSwizzledSelector:<span class="keyword">@selector</span>(EL_setNeedsDisplayInRect:)];</span><br><span class="line">        </span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">-(<span class="keyword">void</span>)EL_setNeedsLayout&#123;</span><br><span class="line">    <span class="keyword">if</span>(![<span class="built_in">NSThread</span> isMainThread])&#123;</span><br><span class="line">        [<span class="keyword">self</span> CrashOnSimulator];</span><br><span class="line">    &#125;</span><br><span class="line">    dispatch_main_async_safe(^()&#123;</span><br><span class="line">        [<span class="keyword">self</span> EL_setNeedsLayout];</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">-(<span class="keyword">void</span>)EL_setNeedsDisplay&#123;</span><br><span class="line">    <span class="keyword">if</span>(![<span class="built_in">NSThread</span> isMainThread])&#123;</span><br><span class="line">        [<span class="keyword">self</span> CrashOnSimulator];</span><br><span class="line">    &#125;</span><br><span class="line">    dispatch_main_async_safe(^()&#123;</span><br><span class="line">        [<span class="keyword">self</span> EL_setNeedsDisplay];</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">-(<span class="keyword">void</span>)EL_setNeedsDisplayInRect:(<span class="built_in">CGRect</span>)Rect&#123;</span><br><span class="line">    <span class="keyword">if</span>(![<span class="built_in">NSThread</span> isMainThread])&#123;</span><br><span class="line">        [<span class="keyword">self</span> CrashOnSimulator];</span><br><span class="line">    &#125;</span><br><span class="line">    dispatch_main_async_safe(^()&#123;</span><br><span class="line">        [<span class="keyword">self</span> EL_setNeedsDisplay];</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">-(<span class="keyword">void</span>)CrashOnSimulator&#123;</span><br><span class="line">    <span class="keyword">if</span> (TARGET_OS_SIMULATOR) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">NSException</span> *exception = [[<span class="built_in">NSException</span> alloc] initWithName:<span class="string">@"å­çº¿ç¨‹åˆ·æ–°UIäº†"</span> reason:<span class="literal">nil</span> userInfo:<span class="literal">nil</span>];</span><br><span class="line">        [exception raise];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ç¦æ­¢å­çº¿ç¨‹åˆ·æ–°UI"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)swizzleSelector:(SEL)originalSelector withSwizzledSelector:(SEL)swizzledSelector&#123;</span><br><span class="line">    </span><br><span class="line">    Class <span class="keyword">class</span> = [<span class="keyword">self</span> <span class="keyword">class</span>];</span><br><span class="line">    </span><br><span class="line">    Method originalMethod = class_getInstanceMethod(<span class="keyword">class</span>, originalSelector);</span><br><span class="line">    </span><br><span class="line">    Method swizzledMethod = class_getInstanceMethod(<span class="keyword">class</span>, swizzledSelector);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="built_in">BOOL</span> didAddMethod = class_addMethod(<span class="keyword">class</span>,originalSelector,</span><br><span class="line">                                        </span><br><span class="line">                                        method_getImplementation(swizzledMethod),</span><br><span class="line">                                        </span><br><span class="line">                                        method_getTypeEncoding(swizzledMethod));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (didAddMethod) &#123;</span><br><span class="line">        </span><br><span class="line">        class_replaceMethod(<span class="keyword">class</span>,swizzledSelector,</span><br><span class="line">                            </span><br><span class="line">                            method_getImplementation(originalMethod),</span><br><span class="line">                            </span><br><span class="line">                            method_getTypeEncoding(originalMethod));</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        </span><br><span class="line">        method_exchangeImplementations(originalMethod, swizzledMethod);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#endif</span></span><br></pre></td></tr></table></figure></p>
<p>CALayerçš„ä»£ç å¦‚å‡ºä¸€è¾™ï¼Œçœç•¥</p>
<h2 id="å¯ä¼˜åŒ–ç©ºé—´"><a href="#å¯ä¼˜åŒ–ç©ºé—´" class="headerlink" title="å¯ä¼˜åŒ–ç©ºé—´"></a>å¯ä¼˜åŒ–ç©ºé—´</h2><ol>
<li>å†—ä½™ä»£ç è¿‡å¤šï¼Œå¯é€šè¿‡å®å®šä¹‰çš„æ–¹å¼ä»¥æ›´ä¼˜é›…çš„æ–¹å¼å®ç°ï¼Œä½†æ˜¯å®ç”¨çš„å¤ªå¤šä¼šå½±å“ç¼–è¯‘é€Ÿåº¦ã€‚</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/25/é¢„é˜²crashä¹‹åŸºæœ¬æ•°æ®å®¹é”™æœºåˆ¶/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="niuxianbin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/upload/15234019.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="niuxianbinçš„æŠ€æœ¯åšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/25/é¢„é˜²crashä¹‹åŸºæœ¬æ•°æ®å®¹é”™æœºåˆ¶/" itemprop="url">é¢„é˜²crashä¹‹åŸºæœ¬æ•°æ®å®¹é”™æœºåˆ¶</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-02-25T22:33:43+08:00">
                2017-02-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="åŸºæœ¬æ•°æ®ç±»å¯¼è‡´çš„crash"><a href="#åŸºæœ¬æ•°æ®ç±»å¯¼è‡´çš„crash" class="headerlink" title="åŸºæœ¬æ•°æ®ç±»å¯¼è‡´çš„crash"></a>åŸºæœ¬æ•°æ®ç±»å¯¼è‡´çš„crash</h2><p>ä¸€èˆ¬å¯¹äºæ•°ç»„\å­—å…¸ç­‰åŸºæœ¬æ•°æ®ç±»å‹çš„å¢åˆ æ”¹æŸ¥ï¼Œç”±äºæ•°æ®çš„ä¸ç¡®å®šæ€§ï¼Œç»å¸¸ä¼šå¯¼è‡´crashï¼ŒğŸŒ°å¦‚ä¸‹ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSArray</span> *arr = @[@<span class="number">1</span>,@<span class="number">2</span>,@<span class="number">3</span>,@<span class="number">4</span>];</span><br><span class="line"><span class="built_in">NSMutableArray</span> *arrM = @[].mutableCopy;</span><br><span class="line"><span class="built_in">NSDictionary</span> *dic = @&#123;<span class="string">@"test"</span>:<span class="string">@"dic"</span>&#125;;</span><br><span class="line"></span><br><span class="line">[arr objectAtIndex:<span class="number">5</span>];</span><br><span class="line">[arrM addObject:<span class="literal">nil</span>];</span><br><span class="line">[dic objectForKey:<span class="string">@"test1"</span>];</span><br></pre></td></tr></table></figure></p>
<p>ä»¥ä¸Šå‡ ç§æ–¹å¼å°±ä¼šé€ æˆcrashï¼Œ</p>
<h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>æ€è·¯å¾ˆç®€å•ï¼Œå¯ä»¥é€šè¿‡swizzleçš„æ–¹å¼hookå¢åˆ æ”¹æŸ¥çš„æ–¹æ³•ï¼Œæ‰§è¡Œè‡ªå®šä¹‰çš„å¯¹åº”çš„å¢åˆ æ”¹æŸ¥æ–¹æ³•ï¼Œåœ¨è‡ªå®šä¹‰çš„æ–¹æ³•ä¸­è¿›è¡Œæœ¬æ•°æ®ç±»å‹çš„å®‰å…¨æ£€æŸ¥ã€‚å³å¯å¯¹åŸºæœ¬ç±»å‹ä½œå‡ºå®¹é”™ã€‚æˆ‘ä»¬æ—©æœŸçš„é¡¹ç›®ç¿¼é¾™è´·ç†è´¢ç«¯å°±æ˜¯è¿™ä¸ªæ€è·¯ï¼Œç»™NSArray\ NSMutableArray\ NSDictionaryç­‰åŠ Category,hookå¯¹åº”çš„æ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="keyword">void</span>)exchangeAddObjectMethod&#123;</span><br><span class="line">    </span><br><span class="line">    [objc_getClass(<span class="string">"__NSArrayM"</span>) swizzleSelector:<span class="keyword">@selector</span>(addObject:) withSwizzledSelector:<span class="keyword">@selector</span>(safeAddObject:)];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)safeAddObject:(<span class="keyword">id</span>)obj &#123;</span><br><span class="line">    <span class="keyword">if</span> (obj == <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="built_in">NSAssert</span>(obj != <span class="literal">nil</span>, <span class="string">@"add nil object into NSMutableArray"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        [<span class="keyword">self</span> safeAddObject:obj];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å®Œç¾è§£å†³æ–¹æ¡ˆ"><a href="#å®Œç¾è§£å†³æ–¹æ¡ˆ" class="headerlink" title="å®Œç¾è§£å†³æ–¹æ¡ˆ"></a>å®Œç¾è§£å†³æ–¹æ¡ˆ</h2><p>githubä¸Šå·²ç»æœ‰å®Œç¾çš„è½®å­äº†ï¼Œæ²¡å¿…è¦åœ¨è‡ªå·±é€ è½®å­äº†ï¼Œå…¥å£<a href="https://github.com/jasenhuang/NSObjectSafe" target="_blank" rel="noopener">NSObjectSafe</a> æ€è·¯ä¸€æ ·ï¼Œå®ç°çš„æ›´ä¼˜é›…å®Œç¾ ğŸ ğŸ ğŸ ğŸ ğŸ</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/03/pythonè¯»å–Excelæ–‡ä»¶/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="niuxianbin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/upload/15234019.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="niuxianbinçš„æŠ€æœ¯åšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/03/pythonè¯»å–Excelæ–‡ä»¶/" itemprop="url">pythonå¤„ç†Excelæ–‡ä»¶</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-01-03T21:43:23+08:00">
                2017-01-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="pythonçš„é¢˜å¤–è¯å•Š"><a href="#pythonçš„é¢˜å¤–è¯å•Š" class="headerlink" title="pythonçš„é¢˜å¤–è¯å•Š"></a>pythonçš„é¢˜å¤–è¯å•Š</h4><p>é¢˜å¤–è¯ï¼Œè¿™ä¸ªéœ€æ±‚æ¥è‡ªäºè€å©†å¤§äººğŸ™ ï¼Œæœ¬æ¥ä¹Ÿå°±æƒ³å­¦ä¹ pythonï¼Œåˆšå¥½æœ‰äº†åŠ¨åŠ›ğŸ˜‚.é¡¹ç›®APPç˜¦èº«åˆšå¥½èƒ½ç”¨åˆ°python</p>
<h4 id="pythonç¯å¢ƒ"><a href="#pythonç¯å¢ƒ" class="headerlink" title="pythonç¯å¢ƒ"></a>pythonç¯å¢ƒ</h4><p> Macè‡ªå¸¦çš„pythonç¯å¢ƒï¼Œçœäº†å®‰è£…è¿‡ç¨‹ï¼Œåœ¨ç»ˆç«¯è¾“å…¥pythonå³å¯æŸ¥çœ‹ã€‚<br> æ¨èæ¯”è¾ƒå¥½ç”¨çš„é›†æˆå¼€å‘ç¯å¢ƒï¼š<a href="https://www.jetbrains.com/pycharm/download/" target="_blank" rel="noopener">PyCharm</a> </p>
<h4 id="è¯­æ³•åŸºç¡€"><a href="#è¯­æ³•åŸºç¡€" class="headerlink" title="è¯­æ³•åŸºç¡€"></a>è¯­æ³•åŸºç¡€</h4><p> pythonçš„åŸºæœ¬æ•°æ®ç±»å‹ï¼š</p>
<ul>
<li>Numbersï¼ˆæ•°å­—ï¼‰</li>
<li>Stringï¼ˆå­—ç¬¦ä¸²ï¼‰</li>
<li>Listï¼ˆåˆ—è¡¨ï¼‰</li>
<li>Tupleï¼ˆå…ƒç»„ï¼‰</li>
<li>Dictionaryï¼ˆå­—å…¸ï¼‰<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">textNum = <span class="number">100</span></span><br><span class="line"></span><br><span class="line">testStr = <span class="string">"hahaha"</span></span><br><span class="line"></span><br><span class="line">testList = [<span class="number">1</span>,<span class="number">2</span>,<span class="string">"hehe"</span>]</span><br><span class="line"></span><br><span class="line">testTuple = (<span class="number">1</span>,<span class="string">"3"</span>,<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">testDic = &#123;<span class="string">"niu"</span>:<span class="number">123</span>,<span class="string">"ha"</span>:<span class="string">"hehe"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span>  textNum,testStr,testList,testTuple,testDic</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>ç±»å‹å’Œswifté‡Œçš„åŸºæœ¬ä¸€è‡´ï¼Œæ–¹ä¾¿ä½¿ç”¨çš„æ˜¯ä¸ç”¨å£°æ˜ç±»å‹</p>
<h3 id="æµç¨‹æ§åˆ¶è¯­å¥"><a href="#æµç¨‹æ§åˆ¶è¯­å¥" class="headerlink" title="æµç¨‹æ§åˆ¶è¯­å¥"></a>æµç¨‹æ§åˆ¶è¯­å¥</h3><p>python çš„ä»£ç å—ä¸ä½¿ç”¨å¤§æ‹¬å· {} æ¥æ§åˆ¶ç±»ï¼Œå‡½æ•°ä»¥åŠå…¶ä»–é€»è¾‘åˆ¤æ–­ã€‚python æœ€å…·ç‰¹è‰²çš„å°±æ˜¯ç”¨ç¼©è¿›æ¥å†™æ¨¡å—ã€‚ å¦‚ä¸‹ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">printme</span><span class="params">( str )</span>:</span></span><br><span class="line">   <span class="string">"æ‰“å°ä»»ä½•ä¼ å…¥çš„å­—ç¬¦ä¸²"</span></span><br><span class="line">   <span class="keyword">print</span> str;</span><br><span class="line">   <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span>  printme(<span class="number">123</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#æµç¨‹æ§åˆ¶è¯­å¥</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">True</span>:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"True"</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"false"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">False</span>):</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"haha"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> obj <span class="keyword">in</span> [<span class="string">"niu"</span>,<span class="string">"xian"</span>,<span class="string">"bin"</span>]:</span><br><span class="line">    <span class="keyword">print</span> obj</span><br></pre></td></tr></table></figure></p>
<h4 id="python-å¤„ç†æ–‡ä»¶"><a href="#python-å¤„ç†æ–‡ä»¶" class="headerlink" title="python å¤„ç†æ–‡ä»¶"></a>python å¤„ç†æ–‡ä»¶</h4><p>pythonåŸºç¡€å¾ˆå®¹æ˜“ï¼Œç°åœ¨å¼€å§‹å®æˆ˜äº†ã€‚è¯»å–å’Œå†™å…¥éœ€è¦ä¾èµ–ä¸‰ä¸ªç¬¬ä¸‰æ–¹åº“ï¼š<a href="https://pypi.python.org/pypi/xlwt" target="_blank" rel="noopener">xlwt</a> ï¼Œ<a href="https://pypi.python.org/pypi/xlrd" target="_blank" rel="noopener">xlrd</a> , xlutilsï¼Œå®‰è£…è¿‡ç¨‹ä¹Ÿå¾ˆç®€å•ï¼Œç½‘ä¸Šå¾ˆå¤šã€‚<br>åª³å¦‡çš„å…·ä½“éœ€æ±‚æ˜¯ä¸¤ä¸ªsheetè¡¨ï¼ŒæŠŠæ—©é€€äººå‘˜çš„åŸå› æ ¹æ®ç¬¬äºŒè¡¨æ‰“å¡æ—¶é—´åˆ†æå‡ºæ¥<br>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> xlrd</span><br><span class="line"><span class="keyword">import</span> xlwt</span><br><span class="line"><span class="keyword">from</span> xlutils.copy <span class="keyword">import</span> copy</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="comment">#ä¹±ç é—®é¢˜è§£å†³</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">'utf-8'</span>)</span><br><span class="line"></span><br><span class="line">fname = <span class="string">"123.xlsx"</span></span><br><span class="line">bk = xlrd.open_workbook(fname)</span><br><span class="line"><span class="comment">#copyä¸€ä»½ç”¨æ¥å†™å…¥æ•°æ®</span></span><br><span class="line">newb = copy(bk)</span><br><span class="line">shxrange = range(bk.nsheets)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    Sheet1 = bk.sheet_by_name(<span class="string">"Sheet1"</span>)</span><br><span class="line">    Sheet2 = bk.sheet_by_name(<span class="string">"Sheet2"</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"no sheet in %s named Sheet1"</span> % fname</span><br><span class="line"><span class="comment"># è·å–è¡Œæ•°</span></span><br><span class="line">nrows = Sheet1.nrows</span><br><span class="line"><span class="comment"># è·å–åˆ—æ•°</span></span><br><span class="line">ncols = Sheet1.ncols</span><br><span class="line"><span class="keyword">print</span> <span class="string">"sheet1:nrows %d, ncols %d"</span> % (nrows, ncols)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–è¡Œæ•°</span></span><br><span class="line">nrows2 = Sheet2.nrows</span><br><span class="line"><span class="comment"># è·å–åˆ—æ•°</span></span><br><span class="line">ncols2 = Sheet2.ncols</span><br><span class="line"><span class="keyword">print</span> <span class="string">"sheet2:nrows %d, ncols %d"</span> % (nrows2, ncols2)</span><br><span class="line"></span><br><span class="line"><span class="comment">#-------sheet1----------</span></span><br><span class="line"><span class="comment">#äººå‘˜åˆ—è¡¨</span></span><br><span class="line">peopleList = Sheet1.col_values(<span class="number">0</span>)</span><br><span class="line"><span class="comment">#æ—©é€€æ—¶é—´</span></span><br><span class="line">lltimeList = Sheet1.col_values(<span class="number">4</span>)</span><br><span class="line"><span class="comment"># è·å–æ—©é€€çš„äººå‘˜åˆ—</span></span><br><span class="line">listValue = Sheet1.col_values(<span class="number">9</span>)</span><br><span class="line"><span class="comment">#å­˜å‚¨æ—©é€€äººå‘˜ç›¸å…³ä¿¡æ¯</span></span><br><span class="line">zauotuiList = []</span><br><span class="line"></span><br><span class="line"><span class="comment">#-------sheet2----------</span></span><br><span class="line">people2List = Sheet2.col_values(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">lltime2List = Sheet2.col_values(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†™å…¥æ—©é€€åŸå› </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">excelUpdate</span><span class="params">(excel,row,content)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    æ›´æ–°å·²æœ‰excel, æ˜¯copyä¸€ä»½å†åšæ›´æ–°</span></span><br><span class="line"><span class="string">    :param excel:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    wbsheet = newb.get_sheet(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    wbsheet.write(row, <span class="number">10</span>, content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> index <span class="keyword">in</span> range(len(listValue)):</span><br><span class="line">     <span class="keyword">if</span> (<span class="string">"æ—©é€€"</span> <span class="keyword">in</span> listValue[index]):</span><br><span class="line">        peoplename = peopleList[index]</span><br><span class="line">        <span class="keyword">for</span> peopleindex <span class="keyword">in</span> range(len(people2List)):</span><br><span class="line">            <span class="keyword">if</span> (peoplename == people2List[peopleindex]):</span><br><span class="line">             <span class="comment">#   print  lltime2List[peopleindex][2:(lltime2List[peopleindex].index(" "))],lltimeList[index][0:(lltimeList[index].index(" "))]</span></span><br><span class="line">                <span class="keyword">if</span> ((lltime2List[peopleindex][<span class="number">2</span>:(lltime2List[peopleindex].index(<span class="string">" "</span>))] == lltimeList[index][<span class="number">0</span>:(lltimeList[index].index(<span class="string">" "</span>))]) <span class="keyword">and</span> lltime2List[peopleindex][<span class="number">11</span>:<span class="number">13</span>] &gt;=<span class="number">16</span> ):</span><br><span class="line">                   <span class="comment"># print "æ—©é€€äººå‘˜åå­—ï¼š%s æ—¥æœŸï¼š%s å½“å¤©ç›´æ’­æ—¶é—´: %s" % (peoplename,lltimeList[index],lltime2List[peopleindex])</span></span><br><span class="line">                    excelUpdate(newb,index,unicode(<span class="string">"æ™šä¸Šæœ‰ç›´æ’­"</span>, <span class="string">"utf8"</span>))</span><br><span class="line">                   <span class="comment"># print  lltime2List[peopleindex][11:13]</span></span><br><span class="line">                <span class="comment"># print lltime2List[peopleindex],people2List[peopleindex]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">         <span class="comment"># if peopleList[index] ==</span></span><br><span class="line">         <span class="comment"># print "%s %s %s" % (peopleList[index],listValue[index],lltimeList[index][0:(lltimeList[index].index(" "))])</span></span><br><span class="line">         </span><br><span class="line"><span class="comment">#ç”Ÿæˆæ–°çš„Excelæ–‡ä»¶å­˜å‚¨ç£ç›˜</span></span><br><span class="line">newb.save(<span class="string">"123456.xlsx"</span>)</span><br></pre></td></tr></table></figure></p>
<h4 id="ç»“å°¾"><a href="#ç»“å°¾" class="headerlink" title="ç»“å°¾"></a>ç»“å°¾</h4><p>å­¦ä¹ æ–°è¯­è¨€åŸºç¡€å¾ˆç®€å•ï¼Œä½†æ˜¯çœŸæ­£ä½¿ç”¨è¿˜æ˜¯ä¼šé‡åˆ°å„ç§é—®é¢˜ï¼Œä½†æ˜¯åœ¨å®è·µä¸­æ‰èƒ½å­¦çš„æ›´å¿«ã€‚ğŸğŸåæœŸæ‰“ç®—è‡ªå·±å†™APPç˜¦èº«è„šæœ¬ï¼Œfightingï¼Œæ„Ÿè°¢æ•°æ®éƒ¨å¤§ç¥@å¸é©¬æŒ‡ç‚¹</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/01/iOS runtimeçš„isaæŒ‡é’ˆ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="niuxianbin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/upload/15234019.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="niuxianbinçš„æŠ€æœ¯åšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/01/iOS runtimeçš„isaæŒ‡é’ˆ/" itemprop="url">iOS runtime ä¹‹ isaæŒ‡é’ˆ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2016-12-01T22:33:43+08:00">
                2016-12-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="OCçš„ç±»å’Œå¯¹è±¡çš„å…³ç³»å›¾"><a href="#OCçš„ç±»å’Œå¯¹è±¡çš„å…³ç³»å›¾" class="headerlink" title="OCçš„ç±»å’Œå¯¹è±¡çš„å…³ç³»å›¾"></a>OCçš„ç±»å’Œå¯¹è±¡çš„å…³ç³»å›¾</h2><p><img src="/img/0326.jpeg" alt=""><br>ç»å…¸å›¾é•‡æ¥¼ğŸ’›ğŸ’›ğŸ’›ğŸ’›ğŸ’›</p>
<h2 id="isa"><a href="#isa" class="headerlink" title="isa"></a>isa</h2><p>objc.hå¤´æ–‡ä»¶çš„è§£é‡Š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// An opaque type that represents an Objective-C class.</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_class *Class;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Represents an instance of a class.</span></span><br><span class="line"><span class="keyword">struct</span> objc_object &#123;</span><br><span class="line">    Class _Nonnull isa  OBJC_ISA_AVAILABILITY;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// A pointer to an instance of a class.</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_object *<span class="keyword">id</span>;</span><br></pre></td></tr></table></figure></p>
<p>runtime.hæ–‡ä»¶ä¸­ç±»çš„å®šä¹‰<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> objc_class &#123;</span><br><span class="line">    Class _Nonnull isa  OBJC_ISA_AVAILABILITY;</span><br><span class="line"></span><br><span class="line"><span class="meta">#if !__OBJC2__</span></span><br><span class="line">    Class _Nullable super_class                              OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> * _Nonnull name                               OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">long</span> version                                             OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">long</span> info                                                OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">long</span> instance_size                                       OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">struct</span> objc_ivar_list * _Nullable ivars                  OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">struct</span> objc_method_list * _Nullable * _Nullable methodLists                    OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">struct</span> objc_cache * _Nonnull cache                       OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">struct</span> objc_protocol_list * _Nullable protocols          OBJC2_UNAVAILABLE;</span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line"></span><br><span class="line">&#125; OBJC2_UNAVAILABLE;</span><br></pre></td></tr></table></figure></p>
<p>1 idå’ŒClasséƒ½æ˜¯æŒ‡é’ˆç±»å‹<br>2 å¯¹è±¡å’Œç±»éƒ½æœ‰isaæŒ‡é’ˆï¼›</p>
<h2 id="isaçš„å€¼"><a href="#isaçš„å€¼" class="headerlink" title="isaçš„å€¼"></a>isaçš„å€¼</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> <span class="built_in">NSObject</span> *object = [[<span class="built_in">NSObject</span> alloc]init];</span><br><span class="line"> object-&gt;isa;</span><br><span class="line"><span class="comment">//OCçš„isaæŒ‡é’ˆæ— æ³•å‘C++çš„æ–¹å¼ç›´æ¥ä½¿ç”¨ï¼Œå¿…é¡»é€šè¿‡object_getClass()/object_setClass()ä½¿ç”¨</span></span><br></pre></td></tr></table></figure>
<h2 id="isaçš„æ€»ç»“"><a href="#isaçš„æ€»ç»“" class="headerlink" title="isaçš„æ€»ç»“"></a>isaçš„æ€»ç»“</h2><p>1 æ¯ä¸€ä¸ªå¯¹è±¡æœ¬è´¨ä¸Šéƒ½æ˜¯ä¸€ä¸ªç±»çš„å®ä¾‹ã€‚å…¶ä¸­ç±»å®šä¹‰äº†æˆå‘˜å˜é‡å’Œæˆå‘˜æ–¹æ³•çš„åˆ—è¡¨ã€‚å¯¹è±¡é€šè¿‡å¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘ç±»ã€‚</p>
<p>2 æ¯ä¸€ä¸ªç±»æœ¬è´¨ä¸Šéƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç±»å…¶å®æ˜¯å…ƒç±»ï¼ˆmeteClassï¼‰çš„å®ä¾‹ã€‚å…ƒç±»å®šä¹‰äº†ç±»æ–¹æ³•çš„åˆ—è¡¨ã€‚ç±»é€šè¿‡ç±»çš„isaæŒ‡é’ˆæŒ‡å‘å…ƒç±»ã€‚</p>
<p>3 æ‰€æœ‰çš„å…ƒç±»æœ€ç»ˆç»§æ‰¿ä¸€ä¸ªæ ¹å…ƒç±»ï¼Œæ ¹å…ƒç±»isaæŒ‡é’ˆæŒ‡å‘æœ¬èº«ï¼Œå½¢æˆä¸€ä¸ªå°é—­çš„å†…å¾ªç¯</p>
<h2 id="isaçš„å¦™ç”¨"><a href="#isaçš„å¦™ç”¨" class="headerlink" title="isaçš„å¦™ç”¨"></a>isaçš„å¦™ç”¨</h2><p>1  ç³»ç»Ÿé€šè¿‡æŒ‡é’ˆæ··å†™(isa-swizzling)çš„æ–¹å¼å®ç°KVOï¼šå°±æ˜¯å°†å½“å‰å¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘è‡ªå·±è¿è¡Œæ—¶ç”Ÿæˆçš„å­ç±»ï¼Œç„¶åé‡å†™äº†å­ç±»å¯¹åº”çš„setteræ–¹æ³•,åœ¨setteræ–¹æ³•é‡Œæ‰§è¡ŒKVOçš„æ–¹æ³•ï¼Œç„¶åå†[super setter]èµ‹å€¼ã€‚<br>è‡ªå·±æŒ‰ç…§ä»¥ä¸Šæ€è·¯å®ç°äº†ä¸‹KVOï¼Œä»£ç é‡å¤§ï¼Œè´´å‡ºéƒ¨åˆ†æ ¸å¿ƒä»£ç ï¼š<br>æ·»åŠ ç›‘å¬æ–¹æ³•ä¸­ğŸğŸğŸï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *oldClassName = <span class="built_in">NSStringFromClass</span>(<span class="keyword">self</span>.class);</span><br><span class="line">   <span class="built_in">NSString</span> *runtimeName = [<span class="string">@"NIU_"</span> stringByAppendingString:oldClassName];</span><br><span class="line">   Class kvoClass;</span><br><span class="line">   kvoClass = objc_lookUpClass(runtimeName.UTF8String);</span><br><span class="line">   <span class="keyword">if</span> (!kvoClass) &#123;</span><br><span class="line">       <span class="comment">//åŠ¨æ€åˆ›å»ºclass</span></span><br><span class="line">       kvoClass = objc_allocateClassPair(<span class="keyword">self</span>.class, kvoClassName.UTF8String, <span class="number">0</span>);</span><br><span class="line">       objc_registerClassPair(kvoClass);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//å®ç°è‡ªå·±çš„setteræ–¹æ³•</span></span><br><span class="line">   class_addMethod(kvoClass,<span class="built_in">NSSelectorFromString</span>(setterStr), (IMP)setterIMP, <span class="string">"v@:@"</span>);</span><br><span class="line">   <span class="comment">//å°†å½“å‰å¯¹è±¡isaæŒ‡é’ˆæŒ‡å‘kvoClass</span></span><br><span class="line">   object_setClass(<span class="keyword">self</span>, kvoClass);</span><br></pre></td></tr></table></figure></p>
<p>è‡ªå·±å®ç°çš„setteræ–¹æ³•ä¸­éƒ¨åˆ†ğŸğŸğŸ<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> objc_super superClazz = &#123;</span><br><span class="line">        .receiver = <span class="keyword">self</span>,</span><br><span class="line">        .super_class = class_getSuperclass(object_getClass(<span class="keyword">self</span>))</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//è°ƒç”¨super setterèµ‹å€¼</span></span><br><span class="line">    <span class="keyword">void</span> (*action)(<span class="keyword">void</span> *,SEL,<span class="keyword">id</span>) =(<span class="keyword">void</span> (*)(<span class="keyword">void</span> *, SEL, <span class="keyword">id</span>))objc_msgSendSuper;</span><br><span class="line">    action(&amp;superClazz, _cmd, newValue);</span><br><span class="line">    <span class="comment">//æ‰§è¡Œè‡ªå·±ç›‘å¬å›è°ƒ</span></span><br><span class="line">    block();</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/23/atomicå’Œçº¿ç¨‹å®‰å…¨/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="niuxianbin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/upload/15234019.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="niuxianbinçš„æŠ€æœ¯åšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/23/atomicå’Œçº¿ç¨‹å®‰å…¨/" itemprop="url">atomicå’Œçº¿ç¨‹å®‰å…¨</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2016-11-23T20:13:02+08:00">
                2016-11-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="ä¿®é¥°è¯"><a href="#ä¿®é¥°è¯" class="headerlink" title="ä¿®é¥°è¯"></a>ä¿®é¥°è¯</h2><p> ä¸€èˆ¬æˆ‘ä»¬å†™å±æ€§éƒ½æ˜¯nonatomic,è¿™ä¸ªå±æ€§æ•ˆç‡é«˜ï¼Œä½†æ˜¯ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¤šçº¿ç¨‹é€ ä½œä¼šé€ æˆcrashé—®é¢˜ï¼Œæ‰€ä»¥æœ‰äº†atomicï¼Œatomicæ˜¯å¯¹setter/getteræ–¹æ³•æ˜¯çº¿ç¨‹å®‰å…¨ï¼Œä¸ä»£è¡¨è¿™ä¸ªå±æ€§çš„æ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„<br>ï¼Œç¬”è€…æ·±æœ‰ä½“ä¼šï½ï½<br>å¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@property(atomic,strong) NSMutableArray *arrayM;</span><br></pre></td></tr></table></figure></p>
<p>å¯¹äºè¿™ä¸ªå±æ€§åªèƒ½ä¿è¯self.arrayMè¿™æ ·è°ƒç”¨æ˜¯çº¿ç¨‹å®‰å…¨ï¼Œ[self.arrayM addObject:];è¿™æ ·ä½¿ç”¨å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨ï¼Œå¦‚æœæœ‰å¤šçº¿ç¨‹è®¿é—®ï¼Œè¿˜æ˜¯å¯èƒ½ä¼šcrashçš„ï¼Œæ­¤å¤„åªæœ‰é€šè¿‡é”æ¥è§£å†³ï¼Œ</p>
<p>stackoverflowç»å…¸å…³äºatomicçš„è®²è§£<br><a href="https://stackoverflow.com/questions/588866/whats-the-difference-between-the-atomic-and-nonatomic-attributes" target="_blank" rel="noopener">Whatâ€™s the difference between the atomic and nonatomic attributes?</a>  </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/26/GCDå»¶è¿Ÿæ“ä½œ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="niuxianbin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/upload/15234019.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="niuxianbinçš„æŠ€æœ¯åšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/26/GCDå»¶è¿Ÿæ“ä½œ/" itemprop="url">iOSå»¶è¿Ÿæ‰§è¡Œ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2016-10-26T20:31:15+08:00">
                2016-10-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="å»¶æ—¶æ‰§è¡Œ"><a href="#å»¶æ—¶æ‰§è¡Œ" class="headerlink" title="å»¶æ—¶æ‰§è¡Œ"></a>å»¶æ—¶æ‰§è¡Œ</h2><p>æœ€è¿‘996ï¼Œä¸¤ä¸ªæ–°é¡¹ç›®åŠ ç ï¼Œåšå®¢è¶Šæ¥è¶Šæ…¢äº†ã€‚è®°å½•ä¸‹è‡ªå·±é¡¹ç›®çš„æ³¨æ„ç‚¹ã€‚è¨€å½’æ­£ä¼ ã€‚ä¸€èˆ¬å»¶è¿Ÿæ‰§è¡Œæœ€å¸¸ç”¨çš„ï¼š</p>
<ul>
<li>performSelector:withObject:afterDelay</li>
<li>NSTimer</li>
<li>dispatch_after<br>ä¸‰è€…çš„æœ‰ä½•ä¸åŒå’Œç›¸åŒç‚¹å‘¢ï¼Ÿ<br>performSelector:withObject:afterDelay æ˜¯åŸºäºrunloopå®ç°çš„ï¼Œæ‰€ä»¥è¿™ä¸ªä½¿ç”¨åº”è¯¥æ³¨æ„ï¼Œ!!!!åœ¨å­çº¿ç¨‹ä½¿ç”¨éœ€è¦å¼€å¯runloopã€‚å®˜ç½‘è§£é‡Š</li>
</ul>
<blockquote>
<p>This method sets up a timer to perform the aSelector message on the current threadâ€™s run loop. The timer is configured to run in the default mode (NSDefaultRunLoopMode). When the timer fires, the thread attempts to dequeue the message from the run loop and perform the selector. It succeeds if the run loop is running and in the default mode; otherwise, the timer waits until the run loop is in the default mode</p>
</blockquote>
<p>å…¶å®è¿™ä¸ªæ˜¯ç³»ç»Ÿåº•å±‚åˆ›å»ºä¸€ä¸ªtimerï¼Œè¯´åˆ°åº•è¿™ä¸ªæ˜¯å¯ä»¥NStimerå®ç°çš„å»¶æ—¶æ–¹æ³•ï¼Œ<br>è¿™ä¸ªå»¶æ—¶å¯ä»¥å–æ¶ˆï¼Œç³»ç»Ÿæä¾›ä¸¤ä¸ªå¯ä»¥å–æ¶ˆæ“ä½œçš„æ–¹æ³•ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">+ (void)cancelPreviousPerformRequestsWithTarget:(id)aTarget selector:(SEL)aSelector object:(nullable id)anArgument;</span><br><span class="line">+ (void)cancelPreviousPerformRequestsWithTarget:(id)aTarget;</span><br></pre></td></tr></table></figure></p>
<p>NStimerä¹Ÿæ˜¯åŸºäºrunloopï¼Œä½¿ç”¨éœ€è¦åŠ å…¥runloopï¼Œå› æ­¤ä¹Ÿå­˜åœ¨å­çº¿ç¨‹ä½¿ç”¨å¯èƒ½å‡ºç°é—®é¢˜ï¼ˆtimerçš„ä¹Ÿå¯èƒ½äº§ç”Ÿå¾ªç¯å¼•ç”¨é—®é¢˜ä¹Ÿè¦æ³¨æ„ï¼‰<br>ä»¥ä¸Šä¸¤ä¸ªçš„å¥½å¤„å°±æ˜¯éƒ½èƒ½å–æ¶ˆï¼Œ</p>
<h2 id="dispatch-after"><a href="#dispatch-after" class="headerlink" title="dispatch_after"></a>dispatch_after</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//ä½¿ç”¨æ–¹å¼</span><br><span class="line"> dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(5 * NSEC_PER_SEC)), dispatch_queue_create(0, 0), ^&#123;</span><br><span class="line">        NSLog(@&quot;...dispatch_after...&quot;);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p>å®˜ç½‘è§£é‡Š</p>
<blockquote>
<p>This function waits until the specified time and then<br>asynchronously adds block to the specified queue.</p>
</blockquote>
<p>æ„æ€å°±æ˜¯è¿™ä¸ªæ˜¯å»¶è¿Ÿæäº¤ï¼Œå°±æ˜¯å»¶æ—¶åæŠŠblockæäº¤åˆ°åŠ å…¥é˜Ÿåˆ—çš„çš„çº¿ç¨‹ï¼Œè€Œä¸æ˜¯æäº¤åˆ°å¯¹åº”çš„çº¿ç¨‹å»¶è¿Ÿæ‰§è¡Œï¼Œå› æ­¤è¿™ä¸ªæ— æ³•å–æ¶ˆæ“ä½œã€‚</p>
<h2 id="å»¶è¿Ÿæ“ä½œå–æ¶ˆ"><a href="#å»¶è¿Ÿæ“ä½œå–æ¶ˆ" class="headerlink" title="å»¶è¿Ÿæ“ä½œå–æ¶ˆ"></a>å»¶è¿Ÿæ“ä½œå–æ¶ˆ</h2><p>[[NSRunLoop currentRunLoop] run]; ï¼šå¼€å§‹è¿è¡Œå¾ªç¯<br>å¼€å¯å¾ªç¯ä¹‹å‰ï¼Œå¿…é¡»æœ‰å®šæ—¶æºæˆ–è€…è¾“å…¥æºç»™ä»–ï¼Œä¸ç„¶runloopè¿è¡Œå®Œä¼šé€€å‡ºã€‚<br>performSelector:withObject:afterDelay è¿™ä¸ªæ–¹æ³•åº•å±‚åˆ›å»ºçš„timerï¼ŒNStimerä¹Ÿæ˜¯timerï¼Œä½†æ˜¯éœ€è¦æ‰‹åŠ¨åŠ å…¥è¿è¡Œå¾ªç¯ï¼Œé€šè¿‡æ‰“runloopæœ‰ä½•ä¸åŒ,æ¥è§‚å¯Ÿcancleæ“ä½œæ€ä¹ˆå®ç°åŸç†ï¼Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">dispatch_async(dispatch_get_global_queue(0, 0), ^&#123;</span><br><span class="line">        [[NSRunLoop currentRunLoop ] run];</span><br><span class="line">        NSLog(@&quot;0:%@&quot;,[NSRunLoop currentRunLoop]);</span><br><span class="line">        [self performSelector:@selector(test) withObject:nil afterDelay:2.0];</span><br><span class="line">        NSLog(@&quot;1:%@&quot;,[NSRunLoop currentRunLoop]);</span><br><span class="line">        [self performSelector:@selector(test) withObject:nil afterDelay:4.0];</span><br><span class="line">        NSLog(@&quot;2:%@&quot;,[NSRunLoop currentRunLoop]);</span><br><span class="line">        [self performSelector:@selector(test) withObject:nil afterDelay:4.0];</span><br><span class="line">        NSLog(@&quot;3:%@&quot;,[NSRunLoop currentRunLoop]);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure></p>
<p>å› ä¸ºæœ‰å¾ˆå¤šå±æ€§ï¼Œæˆªå›¾ä¸æ–¹ä¾¿ï¼Œæˆ‘å°±æ‰‹åŠ¨å¤åˆ¶äº†logæ—¥å¿—ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0 :timers = (null),</span><br><span class="line">1 :timers = &lt;CFArray 0x6040000af180 [0x1053dcbb0]&gt;&#123;type = mutable-small, count = 1, values = (...</span><br><span class="line">2 :timers = &lt;CFArray 0x6040000af180 [0x1053dcbb0]&gt;&#123;type = mutable-small, count = 2, values = (...</span><br><span class="line">3 :timers = &lt;CFArray 0x6040000af180 [0x1053dcbb0]&gt;&#123;type = mutable-small, count = 3, values = (...</span><br></pre></td></tr></table></figure></p>
<p>ä»¥ä¸ŠåŸç†ï¼štimeræ˜¯æ”¾åˆ°runloopçš„ timersæ•°ç»„ä¸­äº†ï¼Œåœ¨runloop runçš„æ—¶å€™Observeræ‰§è¡Œtimersçš„timerã€‚<br>å–æ¶ˆçš„æ–¹å¼å°±æ˜¯åœ¨runloop runä¹‹å‰æŠŠtimerå–æ¶ˆäº†:<br><img src="/img/6.png" alt=""><br>å¼€å‘è€…æ–‡æ¡£å¯¹cancleçš„è§£é‡Šï¼šå°±æ˜¯å–æ¶ˆçš„æ˜¯ä¸‹ä¸€æ¬¡çš„ next run loop cycle çš„timerï¼Œä»¥ä¸‹ä»£ç çš„testæ–¹æ³•æ‰§è¡Œæ¬¡æ•°ç»“æœå°±æ¸…æ™°æ˜äº†äº†ï¼š3æ¬¡å’Œ1æ¬¡<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">dispatch_async(dispatch_get_global_queue(0, 0), ^&#123;</span><br><span class="line">        </span><br><span class="line">        for (int i=0; i&lt;3 ; i++) &#123;</span><br><span class="line">            [NSObject cancelPreviousPerformRequestsWithTarget:self selector:@selector(test) object:nil];</span><br><span class="line">            [self performSelector:@selector(test) withObject:nil afterDelay:1];</span><br><span class="line">              [[NSRunLoop currentRunLoop] run];</span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_async(dispatch_get_global_queue(0, 0), ^&#123;</span><br><span class="line">        </span><br><span class="line">        for (int i=0; i&lt;3 ; i++) &#123;</span><br><span class="line">            [NSObject cancelPreviousPerformRequestsWithTarget:self selector:@selector(test) object:nil];</span><br><span class="line">            [self performSelector:@selector(test) withObject:nil afterDelay:1];</span><br><span class="line">        &#125;</span><br><span class="line">        [[NSRunLoop currentRunLoop] run];</span><br><span class="line">        </span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/09/18/iOSç¼–ç è§„èŒƒ-äºŒ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="niuxianbin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/upload/15234019.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="niuxianbinçš„æŠ€æœ¯åšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/18/iOSç¼–ç è§„èŒƒ-äºŒ/" itemprop="url">iOSç¼–ç è§„èŒƒ-associated_key</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2016-09-18T21:42:37+08:00">
                2016-09-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>å­¦ä¹ ç¬¬ä¸‰æ–¹æºç æ—¶å‘ç°associated_keyçš„èŠ±å¼å†™æ³•</p>
<h4 id="å¸¸è§„å¥—è·¯-NSString"><a href="#å¸¸è§„å¥—è·¯-NSString" class="headerlink" title="å¸¸è§„å¥—è·¯-NSString"></a>å¸¸è§„å¥—è·¯-NSString</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objc_setAssociatedObject(vc, <span class="string">@"objKey"</span>, <span class="string">@"123"</span>, OBJC_ASSOCIATION_ASSIGN);</span><br></pre></td></tr></table></figure>
<h4 id="å˜é‡çš„é™æ€å†…å­˜åœ°å€"><a href="#å˜é‡çš„é™æ€å†…å­˜åœ°å€" class="headerlink" title="å˜é‡çš„é™æ€å†…å­˜åœ°å€"></a>å˜é‡çš„é™æ€å†…å­˜åœ°å€</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŒ‡å‘å­—ç¬¦ä¸²çš„åœ°å€</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">char</span> * JORAutoScrollAssociatedKeyController = <span class="string">"JORAutoScrollAssociatedKeyController"</span>;</span><br><span class="line">objc_setAssociatedObject(<span class="keyword">self</span>, JORAutoScrollAssociatedKeyController, scrollController, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</span><br><span class="line"><span class="comment">// æŒ‡å‘è‡ªå·±çš„åœ°å€</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> * eventAssociatedKey = &amp;eventAssociatedKey;</span><br><span class="line">objc_setAssociatedObject(<span class="keyword">self</span>, eventAssociatedKey, delegate, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</span><br></pre></td></tr></table></figure>
<h4 id="é»˜è®¤åˆå§‹åŒ–çš„å˜é‡-å¸¸é‡åœ°å€"><a href="#é»˜è®¤åˆå§‹åŒ–çš„å˜é‡-å¸¸é‡åœ°å€" class="headerlink" title="é»˜è®¤åˆå§‹åŒ–çš„å˜é‡/å¸¸é‡åœ°å€"></a>é»˜è®¤åˆå§‹åŒ–çš„å˜é‡/å¸¸é‡åœ°å€</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// SDWebImage</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">char</span> imageURLKey;</span><br><span class="line">objc_setAssociatedObject(<span class="keyword">self</span>, &amp;imageURLKey, url, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</span><br><span class="line">objc_getAssociatedObject(<span class="keyword">self</span>, &amp;imageURLKey);</span><br><span class="line"></span><br><span class="line"><span class="comment">// YYAdd</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> block_key;</span><br><span class="line">objc_setAssociatedObject(<span class="keyword">self</span>, &amp;block_key, target, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</span><br><span class="line">objc_getAssociatedObject(<span class="keyword">self</span>, &amp;block_key);</span><br></pre></td></tr></table></figure>
<h4 id="selectorçš„åœ°å€"><a href="#selectorçš„åœ°å€" class="headerlink" title="selectorçš„åœ°å€"></a>selectorçš„åœ°å€</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AFNetWorking:ä½¿ç”¨ @selector</span></span><br><span class="line">- (AFImageDownloadReceipt *)af_activeImageDownloadReceipt &#123;</span><br><span class="line">    <span class="keyword">return</span> (AFImageDownloadReceipt *)objc_getAssociatedObject(<span class="keyword">self</span>, <span class="keyword">@selector</span>(af_activeImageDownloadReceipt));</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)af_setActiveImageDownloadReceipt:(AFImageDownloadReceipt *)imageDownloadReceipt &#123;</span><br><span class="line">    objc_setAssociatedObject(<span class="keyword">self</span>, <span class="keyword">@selector</span>(af_activeImageDownloadReceipt), imageDownloadReceipt, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶å®@selectorï¼Œå°±æ˜¯æ–¹æ³•æœ¬èº«çš„éšè—å‚æ•°_cmdï¼Œä¸¤è€…æ˜¯ä¸€æ ·çš„ã€‚</p>
<h4 id="x1F34E-ç»“å°¾-x1F34E"><a href="#x1F34E-ç»“å°¾-x1F34E" class="headerlink" title="&#x1F34E;ç»“å°¾&#x1F34E;"></a>&#x1F34E;ç»“å°¾&#x1F34E;</h4><p>èåœç™½èœï¼Œä¸ªæœ‰æ‰€çˆ±ï¼Œæˆ‘è¿˜æ˜¯å–œæ¬¢é»˜è®¤å€¼çš„æ–¹å¼</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/upload/15234019.jpeg"
                alt="niuxianbin" />
            
              <p class="site-author-name" itemprop="name">niuxianbin</p>
              <p class="site-description motion-element" itemprop="description">å­œå­œä¸å€¦</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">16</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            

            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">niuxianbin</span>

  
</div>


  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
