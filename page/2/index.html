<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="孜孜不倦">
<meta property="og:type" content="website">
<meta property="og:title" content="niuxianbin的技术博客">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="niuxianbin的技术博客">
<meta property="og:description" content="孜孜不倦">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="niuxianbin的技术博客">
<meta name="twitter:description" content="孜孜不倦">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title>niuxianbin的技术博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">niuxianbin的技术博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">学海无涯</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/21/iOS编码规范-一/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="niuxianbin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/upload/15234019.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="niuxianbin的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/21/iOS编码规范-一/" itemprop="url">iOS编码规范新特性</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-21T21:42:11+08:00">
                2016-08-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>开发者问题抛出越早越容易分析解决问题，编译阶段能给出提示warning，远优于运行时抛出异常或者错误。因此我们要用好苹果大大给提示~~~~</p>
<h4 id="attribute-和NS-UNAVAILABLE"><a href="#attribute-和NS-UNAVAILABLE" class="headerlink" title="attribute()和NS_UNAVAILABLE"></a><strong>attribute</strong>()和NS_UNAVAILABLE</h4><p>开发者，每个人负责的模块不一样，但是模块的初始化方法有很多，但是必须在初始化传参数，这时候可以使用如上两个参数，第三方好多这么用的哦～～<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-(instancetype)new NS_UNAVAILABLE;</span><br><span class="line">-(instancetype)init __attribute__((unavailable(&quot;请用initWithID:&quot;)));</span><br><span class="line">-(instancetype)initWithID:(NSNumber*)number;</span><br></pre></td></tr></table></figure></p>
<h4 id="Nullability-OC的新特性"><a href="#Nullability-OC的新特性" class="headerlink" title="Nullability OC的新特性"></a>Nullability OC的新特性</h4><p>去年的swift2.0后，OC也有了一些对应的新特性。这用来表示一些非空的属性<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@property (nonatomic, strong, nonnull) TestObj *Obj;</span><br></pre></td></tr></table></figure></p>
<p>还有_nullable / nullable 、 __nonnull / nonnull 、 NS_ASSUME_NONNULL_BEGIN NS_ASSUME_NONNULL_END等来表示方法的返回值／参数 &amp; 类属性 是否可以为空，Nullability 在编译器层面提供了空值的类型检查，在类型不符时给出 warning</p>
<h4 id="kindof"><a href="#kindof" class="headerlink" title="__kindof"></a>__kindof</h4><p>判断某对象是否是某类型或其子类型，重点是可以取消父类转换为子类时的warning。如下的用法就会节省类型转化代码，福音啊<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (__kindof UITableViewCell *)dequeueReusableCellWithIdentifier:(NSString *)identifier;</span><br></pre></td></tr></table></figure></p>
<h4 id="NS-DESIGNATED-INITIALIZER"><a href="#NS-DESIGNATED-INITIALIZER" class="headerlink" title="NS_DESIGNATED_INITIALIZER"></a>NS_DESIGNATED_INITIALIZER</h4><p>NS_DESIGNATED_INITIALIZER，可以使用它标志出像 Swift 一样的指定构造器和便捷构造器，它用来指定初始化的方法。如果类中其他初始化方法 必须要调用Designated Initializer，否则有警告。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (instancetype)initWithID:(NSNumber*)number;</span><br><span class="line">- (instancetype)initWithCard:(NSNumber *)Card;</span><br><span class="line">- (instancetype)initWithID:(NSNumber*)number Card:(NSNumber *)Card NS_DESIGNATED_INITIALIZER;</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/07/09/‘copy操作陷阱’/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="niuxianbin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/upload/15234019.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="niuxianbin的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/07/09/‘copy操作陷阱’/" itemprop="url">copy操作陷阱</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-07-09T20:32:49+08:00">
                2016-07-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="copy陷阱"><a href="#copy陷阱" class="headerlink" title="copy陷阱"></a>copy陷阱</h2><p>和同事交流问题，发现简单的也可能理解错，如下这段代码就是例子，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">NSDictionary &lt;NSString *, Model *&gt; *dicTemp = @&#123;@&quot;model&quot;:[[Model alloc] initWithName:@&quot;niuxianbin&quot;]&#125;;</span><br><span class="line">    NSDictionary &lt;NSString *, Model *&gt; *dicCopy = dic.copy;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    [dic objectForKey:@&quot;model&quot;].name = @&quot;123&quot;;</span><br><span class="line">    </span><br><span class="line">   </span><br><span class="line">    BOOL isNameChanged = [[dic objectForKey:@&quot;model&quot;].name isEqualToString:[dicBackup objectForKey:@&quot;model&quot;].name];</span><br><span class="line">    </span><br><span class="line">    if (isNameChanged) &#123;</span><br><span class="line">        NSLog(@&quot;changed&quot;);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        NSLog(@&quot;unchaned&quot;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>刚开始我觉得changed，后来细想错了，你知道错哪了吗？<br>敲黑板：深copy和浅copy理解不到位，</p>
<h2 id="官方文档解释"><a href="#官方文档解释" class="headerlink" title="官方文档解释"></a>官方文档解释</h2><p> Shallow copies and deep copies图示：<br><img src="/img/2.png" alt=""></p>
<p>####copy对于非容器类对象<br>这里指的是NSString,NSNumber等等一类的对象。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NSString *string = @&quot;origionStr&quot;;</span><br><span class="line">    　　NSString *stringCopy = [string copy];</span><br><span class="line">    　　NSMutableString *stringMCopy = [string mutableCopy];</span><br><span class="line">    　　[stringMCopy appendString:@&quot;123&quot;];</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/3.png" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NSMutableString *string = @&quot;origionStr&quot;.mutableCopy;</span><br><span class="line">    　　NSString *stringCopy = [string copy];</span><br><span class="line">    　　NSMutableString *stringMCopy = [string mutableCopy];</span><br><span class="line">    　　[stringMCopy appendString:@&quot;123&quot;];</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/4.png" alt=""><br>对于结果分析可知：<br>copy对于基本对象有两条总结：</p>
<ul>
<li>对于不可变对象，copy（浅copy）是指针复制，mutableCopy（深拷贝）是对象复制。</li>
<li>对于可变对象，copy（浅copy）是对象复制，但是返回的是不可变对象（这也是为什么copy修饰词修饰可变数组可能会造成crash的根本原因），mutableCopy（深拷贝）是对象复制。<br>####copy对于容器类对象<br>关于容器对象的浅copy。Apple有如下解释</li>
</ul>
<blockquote>
<p>There are a number of ways to make a shallow copy of a collection. When you create a shallow copy, the objects in the original collection are sent a retain message and the pointers are copied to the new collection. Listing 1 shows some of the ways to create a new collection using a shallow copy.</p>
</blockquote>
<p>意思就是容器对象的引用计数+1，同时复制了指针。<br>栗子如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NSArray *shallowCopyArray = [someArray copyWithZone:nil];</span><br><span class="line"> </span><br><span class="line">NSDictionary *shallowCopyDict = [[NSDictionary alloc] initWithDictionary:someDictionary copyItems:NO];</span><br></pre></td></tr></table></figure></p>
<p>关于容器对象的深copy，把第二个参数设置为YES就OK了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NSArray *deepCopyArray=[[NSArray alloc] initWithArray:someArray copyItems:YES];</span><br><span class="line">//官方还有第二中方案</span><br><span class="line">NSArray* trueDeepCopyArray = [NSKeyedUnarchiver unarchiveObjectWithData:</span><br><span class="line">          [NSKeyedArchiver archivedDataWithRootObject:oldArray]];</span><br></pre></td></tr></table></figure></p>
<p>此处集合的对象都会收到copyWithZone：的消息，如果集合里的对象遵循 NSCopying 协议，那么对象就会被深复制到新的集合。如果对象没有遵循 NSCopying 协议，而尝试用这种方法进行深复制，会在运行时出错。这种拷贝方式只能够提供一层内存拷贝(one-level-deep copy)，而非真正的深复制。</p>
<h4 id="copy单层深复制-one-level-deep-copy"><a href="#copy单层深复制-one-level-deep-copy" class="headerlink" title="copy单层深复制 (one-level-deep copy)"></a>copy单层深复制 (one-level-deep copy)</h4><p>如果在多层数组中，对第一层进行内容拷贝，其它层进行指针拷贝，这种情况是属于深复制，还是浅复制？官方文档有一段话：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">This kind of copy is only capable of producing a one-level-deep copy. If you only need a one-level-deep copy...</span><br><span class="line"></span><br><span class="line">If you need a true deep copy, such as when you have an array of arrays...</span><br></pre></td></tr></table></figure></p>
<p>苹果认为这种复制不是真正的深复制，而是将其称为单层深复制(one-level-deep copy)<br>总结如下：</p>
<ul>
<li>不可变容器的copy是指针复制，mutableCopy是对象复制（此处仅是对象copy，内部元素是指针copy）</li>
<li>可变容器的copy是对象复制（返回不可变对象），mutableCopy是对象复制。<br>参考：<br>1 <a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/Collections/Articles/Copying.html/" target="_blank" rel="noopener">https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/Collections/Articles/Copying.html</a><br>2  <a href="http://blog.csdn.net/fanjunxi1990/article/details/16846393" target="_blank" rel="noopener">iOS Copy 和 MutableCopy的区别 深浅拷贝的区别</a> </li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/06/01/weakSelf和stronSelf的小秘密/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="niuxianbin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/upload/15234019.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="niuxianbin的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/06/01/weakSelf和stronSelf的小秘密/" itemprop="url">weakSelf和stronSelf的小秘密</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-06-01T23:07:15+08:00">
                2016-06-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="block循环引用"><a href="#block循环引用" class="headerlink" title="block循环引用"></a>block循环引用</h2><p>开发中，block的使用频率特别高，不小心发生循环引用的概率更高，首先我们会想到的以下就是用weakself解决，最常见的循环引用：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-(void)testBlock&#123;</span><br><span class="line"> </span><br><span class="line">    self.block = ^&#123;</span><br><span class="line">        self.testStr = @&quot;test&quot;;</span><br><span class="line">        _testStr = @&quot;test&quot;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>产生循环引用的原因如下图<br><img src="/img/123.png" alt=""></p>
<h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p>由于引用产生了循环所以需要打破循环，解决方式如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__weak typeof(self) weakSelf = self</span><br></pre></td></tr></table></figure></p>
<h2 id="不会造成循环引用的block"><a href="#不会造成循环引用的block" class="headerlink" title="不会造成循环引用的block"></a>不会造成循环引用的block</h2><p>一般我们使用GCD或者UIView的动画系统带的block回调，如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">__weak typeof(self) weakSelf = self;</span><br><span class="line">    dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        weakSelf.testStr = @&quot;testblock&quot;;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure></p>
<p><mark>敲黑板，这个用法时错误的。。。</mark><br>因为此时将block传给dispatch_async时，系统会将其copy到堆上，block会持用block中的用到的对象，dispatch_async不知道self什么时候释放，因此retain一次self，任务执行完再release掉，假如这里用__weak，有可能self已经释放掉，而block还没执行，产生不可预期的问题。</p>
<h2 id="block执行中对象被释放"><a href="#block执行中对象被释放" class="headerlink" title="block执行中对象被释放"></a>block执行中对象被释放</h2><p>在AFN的源码中，可以看到如下用法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">__weak __typeof(self)weakSelf = self;</span><br><span class="line">   AFNetworkReachabilityStatusBlock callback = ^(AFNetworkReachabilityStatus status) &#123;</span><br><span class="line">       __strong __typeof(weakSelf)strongSelf = weakSelf;</span><br><span class="line"></span><br><span class="line">       strongSelf.networkReachabilityStatus = status;</span><br><span class="line">       if (strongSelf.networkReachabilityStatusBlock) &#123;</span><br><span class="line">           strongSelf.networkReachabilityStatusBlock(status);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">   &#125;;</span><br></pre></td></tr></table></figure></p>
<p>block没有强引用对象，这样可能会产生一个问题：当block回调被执行的时候，其弱引用的对象随时都有可能被外部释放！为避免block在执行过程中相关的对象被释放，因此要用了strongSelf～～～～；</p>
<h2 id="block的本质"><a href="#block的本质" class="headerlink" title="block的本质"></a>block的本质</h2><p>关于block有很多技术大牛的博客，基本总结起来block就是一个里面存储了指向函数体中包含定义block时的代码块的函数指针，以及block外部上下文变量等信息的结构体，可以通过clang -rewrite-objc 我们就可以通过C++的代码东西洞悉其奥妙。</p>
<p>感谢大神：<br><a href="https://www.jianshu.com/p/51d04b7639f1" target="_blank" rel="noopener">Block技巧与底层解析</a><br><a href="http://blog.devtang.com/2013/07/28/a-look-inside-blocks/" target="_blank" rel="noopener">谈Objective-C block的实现</a><br><a href="http://blog.csdn.net/Lotheve/article/details/51992386" target="_blank" rel="noopener">和block循环引用说再见</a><br><a href="http://www.galloway.me.uk/2012/10/a-look-inside-blocks-episode-1/" target="_blank" rel="noopener">A look inside blocks: Episode 1</a><br><a href="http://blog.csdn.net/friday_holiday/article/details/50522778" target="_blank" rel="noopener">block的循环引用究竟是什么鬼？</a> </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/05/13/开发中宏的使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="niuxianbin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/upload/15234019.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="niuxianbin的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/13/开发中宏的使用/" itemprop="url">优雅高效开发的宏</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-05-13T22:46:10+08:00">
                2016-05-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="宏在开发中的使用"><a href="#宏在开发中的使用" class="headerlink" title="宏在开发中的使用"></a>宏在开发中的使用</h2><p>开发中我们一些有关布局的尺寸，我们通常会用宏定义，最基本的使用如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#define SCREEN_WIDTH   [UIScreen mainScreen].bounds.size.width</span><br><span class="line">#define SCREENH_HEIGHT [UIScreen mainScreen].bounds.size.height</span><br></pre></td></tr></table></figure></p>
<p>在研究MJExtension，SDSDWebImage源码发现宏更有效率的使用方式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> SDSDWebImage中关于需要在主线程执行的block；</span><br><span class="line">**/</span><br><span class="line"></span><br><span class="line">#define dispatch_main_async_safe(block)\</span><br><span class="line">if ([NSThread isMainThread]) &#123;\</span><br><span class="line">	block();\</span><br><span class="line">&#125; else &#123;\</span><br><span class="line">	dispatch_async(dispatch_get_main_queue(), block);\</span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line"> MJ归档的实现</span><br><span class="line">**/</span><br><span class="line">#define MJCodingImplementation \</span><br><span class="line">- (id)initWithCoder:(NSCoder *)decoder \</span><br><span class="line">&#123; \</span><br><span class="line">if (self = [super init]) &#123; \</span><br><span class="line">[self mj_decode:decoder]; \</span><br><span class="line">&#125; \</span><br><span class="line">return self; \</span><br><span class="line">&#125; \</span><br><span class="line">\</span><br><span class="line">- (void)encodeWithCoder:(NSCoder *)encoder \</span><br><span class="line">&#123; \</span><br><span class="line">[self mj_encode:encoder]; \</span><br><span class="line">&#125;</span><br><span class="line">#define MJExtensionCodingImplementation MJCodingImplementation</span><br></pre></td></tr></table></figure></p>
<p>由以上我们可以联想到进行代码中冗余代码的抽取，格式统一，出现频次较高的代码：</p>
<ul>
<li>settet/getter</li>
<li>lazy load </li>
<li>初始化方法<br>其中懒加载的代码如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#define lazy_load(_type_, _name_) \</span><br><span class="line">- (_type_ *)_name_; \</span><br><span class="line">&#123; \</span><br><span class="line">    if (!_##_name_) &#123; \</span><br><span class="line">        _##_name_ = [_type_ new]; \</span><br><span class="line">    &#125; \</span><br><span class="line">return _##_name_; \</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>以上宏中的：##两个代表前后字符是拼接的，#代表替换</p>
<h2 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h2><p>宏属于预编译指令，只是简单的替换，并没有语法检查，所以写的时候务必认真，不然别人使用相当痛苦，感谢以下大神：</p>
<p><a href="https://wangdetong.github.io/2016/10/05/20161005%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96%E4%B9%8B%E5%AE%8F%E5%AE%9A%E4%B9%89-macros/" target="_blank" rel="noopener">代码优化之宏定义 - macros</a><br><a href="http://www.jianshu.com/p/213b3b96cafe" target="_blank" rel="noopener">iOS 日常工作之常用宏定义大全</a> </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/05/03/iOS的NSNotification/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="niuxianbin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/upload/15234019.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="niuxianbin的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/03/iOS的NSNotification/" itemprop="url">iOS的NSNotification</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-05-03T10:04:41+08:00">
                2016-05-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="iOS的NSNotificationCenter"><a href="#iOS的NSNotificationCenter" class="headerlink" title="iOS的NSNotificationCenter"></a>iOS的NSNotificationCenter</h2><p>页面间传值的常见三种方式：代理、通知、block。通知也就是广播模式，可以是实现多对一的监听。</p>
<h2 id="通知是同步？异步？"><a href="#通知是同步？异步？" class="headerlink" title="通知是同步？异步？"></a>通知是同步？异步？</h2><p>同步的同步和异步都是相对于发送通知的线程而言，同步会阻塞当前线程，异步则先执行监听方法。                                     通知是同步的，当然可以实现异步监听：通过通知队列（Notification Queues）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(notification) name:@&quot;name&quot; object:nil];</span><br><span class="line">    NSLog(@&quot;start&quot;);</span><br><span class="line">    [[NSNotificationCenter defaultCenter] postNotificationName:@&quot;name&quot; object:nil];</span><br><span class="line">    NSLog(@&quot;post&quot;);</span><br><span class="line">&#125;</span><br><span class="line">-(void)notification&#123;</span><br><span class="line">    [NSThread sleepForTimeInterval:10];</span><br><span class="line">    NSLog(@&quot;notification&quot;);</span><br><span class="line">&#125;</span><br><span class="line">//打印的结果为：start，notification，post；</span><br></pre></td></tr></table></figure></p>
<p>结果如图<br><img src="/img/1.png" alt=""><br>会发现主线程阻塞了10S，此处就应该想到通知对接的用途，把要发送通知加入通知队列，如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">NSLog(@&quot;start&quot;);</span><br><span class="line">    NSNotification *notification = [NSNotification notificationWithName:@&quot;name&quot;</span><br><span class="line">                                                                 object:nil];</span><br><span class="line">    [[NSNotificationQueue defaultQueue] enqueueNotification:notification</span><br><span class="line">                                               postingStyle:NSPostASAP];</span><br><span class="line">    NSLog(@&quot;post&quot;);</span><br><span class="line">    打印结果：：start，post，notification；</span><br></pre></td></tr></table></figure></p>
<h2 id="监听的线程安全问题"><a href="#监听的线程安全问题" class="headerlink" title="监听的线程安全问题"></a>监听的线程安全问题</h2><p>通知监听方法会处理很多不同的逻辑，但是无法判断通知到底是在哪个线程发送的，所以此处我们刷新UI的操作时，需要先判断，在官方文档中；通知和线程的解释：</p>
<blockquote>
<p>Regular notification centers deliver notifications on the thread in which the notification was posted.<br>Distributed notification centers deliver notifications on the main thread.<br>At times, you may require notifications to be delivered on a particular thread that is determined by you instead of the notification center.<br> For example, if an object running in a background thread is listening for notifications from the user interface, such as a window closing, you would like to receive the notifications in the background thread instead of the main thread. In these cases, you must capture the notifications as they are delivered on the default thread and redirect them to the appropriate thread.</p>
</blockquote>
<p>大致的意思就是监听方法是和发送通知是在同一线程中，在监听方法中如果有刷新UI的操作，必须先判断线程。<br>NSNotificationCenter是线程安全的，在多线程可以放心使用。无需加锁考。</p>
<h2 id="通知的移除"><a href="#通知的移除" class="headerlink" title="通知的移除"></a>通知的移除</h2><p>在iOS8之前，我们必须手动移出，不然在监听对象释放后，会产生野指针导致crash，但是iOS9以后不手动移出也没问题了，原因是iOS通知中心对observer引用的修饰词变化了</p>
<ul>
<li>iOS 8及其之前用unsafe_unretained</li>
<li>iOS 9以后用了weak</li>
</ul>
<p>所以即使手动不移除，也不会有问题。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/05/01/迁移/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="niuxianbin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/upload/15234019.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="niuxianbin的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/01/迁移/" itemprop="url">迁移</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-05-01T14:53:23+08:00">
                2016-05-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>   博客分享中断好久，今天从CSDN迁移到GitHub上，markDown确实能提高效率，以后都在这了～。<br>   学海无涯，孜孜不倦，加油～</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/upload/15234019.jpeg"
                alt="niuxianbin" />
            
              <p class="site-author-name" itemprop="name">niuxianbin</p>
              <p class="site-description motion-element" itemprop="description">孜孜不倦</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">16</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">niuxianbin</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
